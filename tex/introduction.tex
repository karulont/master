\section{Introduction}
It does not take a scientific paper to see that the number of cars on our
streets has increased. This creates a need for more parking places. It is
common for shopping centers and other public places with lots of quests to have
large parking lots or even parking houses. However, finding a parking space
still is a frustrating experience for the drivers. Some fancy places have valet
parking. Valet parking is rare in Estonia, but it is quite common in North
America. Valet parking means that the driver does not have to self-park and a
valet will park their car.

Since the industrial revolution when a lot of manufacturing by hand was replaced
by automation, other manual tasks are handed over to machines. One of those
tasks is valet parking. Instead of a human valet, there is a parking robot that
carries your car to a free parking space. In the system explored in this
thesis, drivers will stop their cars on a special platform. A parking robot can
freely move under those platforms and also can lift the platform up from the
ground and carry it to another place with the drivers car still on the
platform. For a driver the experience should be very similar to regular valet
parking: driver stops near the door and does not need to worry about parking,
after visiting the venue the driver can notify the system and will have their
car brought back to them.
\TODO{Write about a more concrete system.}
\subsection{The problem}
\TODO{Some pictures of actual robots?}
In an automated valet parking system, the software has to choose which of
possibly many parking robots will service the incoming parking or car retrieval
request, it will also need to figure out a path for the robots. Regular car
parks have passageways, so that no car is parked in a way that would block
other cars from entering or exiting. In an automated system we do not need
passageways, because blocking cars can be lifted and moved out of the way.
It is important that the time taken to retrieve cars is minimized, otherwise
drivers feel like they are wasting their time, waiting for their car. In a car
park without passageways, the parking robots have to be cooperative and cannot
do path planning as independent agents like in~\cite{wurman2008coordinating}.

There are a lot of optimization problems in a automated parking system
described. We chose to tackle a sub-problem: given a initial configuration of
robots and cars in the system and a terminal configuration, find the best
sequence of actions for robots to transform the initial configuration into the
terminal configuration. Note that best in this case means mostly shortest time,
but we might also want to avoid unneeded actions because they waste energy and
moving parts wear.

\TODO{write about other approaches}

We chose to specify the problem as an integer programming model optimization
problem. Unlike approximation algorithms, integer programming will give us a
strong guarantee that the solution found is in fact optimal.

\subsection{More specific problem description}
The parking robot can move either forwards, backwards or sideways. The length of
the parking space is 6 meters, and it is 3 meters wide. The robots have smaller
dimensions. Every action takes some time. Lifting a car takes 9 seconds,
lowering it will take 3 seconds. The speed of the robot is 2 meters per second,
when not carrying a car, and 1 meter per second, when loaded. Robots needs time
to accelerate and de-accelerate. Changing the direction takes 3 seconds.

The last paragraph describes the information we received. However there is still
some room to interpret the acceleration of the robot. It is said that changing
direction takes 3 seconds. The interpretation we used, is that it takes 1.5
seconds to stop a robot moving at it's maximum speed. And another 1.5 seconds to
accelerate it to maximum speed in another direction. Maximum speed depends on
whether the robot is carrying a car or not, however it makes sense that the
acceleration of robot can be greater, when the mass is lower. Meaning that a
heavy loaded robot can accelerate to speed 1 meter per second and that the empty
robot can accelerate to speed 2 meters per second in the same time. It might
help to see~\autoref{fig:changedir}.

\begin{figure}[h]
    \begin{center}
        \input{fig/changedir}
        \caption{This diagram serves as an illustration for the interpretation of
            time it takes to change direction. The direction of movement can change
            instantaneously, when speed is 0. Change of direction is not explicitly shown on
            this graph.}
        \label{fig:changedir}
    \end{center}
\end{figure}

It is assumed that car park is a grid of of parking spaces. We define a set of
directions as $\D = \{\Dn, \De, \Ds, \Dw\}$. A parking place in the $\Dn$ -
$\Ds$ dimension is 6 meters long, and in the $\De$ - $\Dw$ dimension is 3
meters wide. Note that the directions defined here do not have to correspond to
geographical directions.

After those definitions we can say that an empty robot can go to adjacent space
in the $\Dn$ or $\Ds$ direction in 4.5 seconds. Empty robot can go to adjacent
space in the shorter dimension in 3 seconds. A loaded robot needs 7.5 seconds
to reach adjacent parking space in the longer dimension and 4.5 seconds for
shorter dimension. Speed versus time graph of all of those movements is
on~\autoref{fig:moving times}, the area under those lines is equal to the
dimensions of the parking space.
\begin{figure}[h]
    \begin{center}
        \input{fig/moving-times}
        \caption{This figure shows all the possible movements to an adjacent
        parking space.}
        \label{fig:moving times}
    \end{center}
\end{figure}

When a robot decides to move many spaces in one direction the distance traveled
is equal to distance traveled: while accelerating, while de-accelerating and
while moving with full speed. For an empty robot the distance traveled while
accelerating and de-accelerating sums to 3 meters. For each additional parking
place traveled we need 1.5 seconds for $\De$ or $\Dw$ direction. For $\Dn$ or
$\Ds$ direction we first need to add 1.5 seconds for the first space and 3
seconds for each additional parking space. For an loaded robot the distance traveled
while accelerating and de-accelerating sums to 1.5 meters. For the shorter
dimension of the parking space, we need additional 1.5 seconds, to reach a full 3
meters. For additional spaces, we need to add 3 seconds for each additional
space traveled. For the longer dimension, we need additional 4.5 seconds, and
for each additional space we need to add 6 seconds to reach the desired
distance.

As an example, lets consider that a loaded robot want to move 3
parking spaces in the direction $\Dn$. The total distance needed to cover is
$3\times 6 = 18$ meters. The time it takes is $3 + 4.5 + 2 \times 6 = 19.5s$
seconds. Lets verify that the distance is right: for 3 second we are
accelerating and de-accelerating, with top speed 1 $\frac{m}{s}$, the average
speed being 0.5 $\frac{m}{s}$. Other time we are moving with top speed which is 1
$\frac{m}{s}$. The distance traveled will be $3 * 0.5 + 4.5 \times 1 + 2(6
\times 1) = 18$ meters. An additional example is shown
on~\autoref{fig:manyspaces}.
\begin{figure}[h]
    \begin{center}
        \input{fig/manyspaces}
        \caption{This figure shows the movement of an empty robot in $\Dn$ or
            $\Ds$ direction with moving for 2 parking spaces. The total distance
            traveled is 12 meters, which is exactly the length of 2 parking spaces in
        that direction.}
        \label{fig:manyspaces}
    \end{center}
\end{figure}

\begin{table}
    \begin{center}
        \begin{tabular}{| c | c |}
            \hline
            Action & Time (s)\\
            \hline
            Lift car & 9\\
            Drop car & 3\\
            Accelerate to full speed & 1.5\\
            Deacceleration from full speed to stop & 1.5\\
            Loaded robot moving to adjacent space (N or S) & 7.5\\
            Loaded robot moving to adjacent space (E or W) & 4.5\\
            Empty robot moving to adjacent space (N or S) & 3\\
            Empty robot moving to adjacent space (E or W) & 4.5\\
            \hline
        \end{tabular}
        \TODO{make this table nice}
        \caption{We list different actions and the time they need to complete.}
        \label{tbl:times}
    \end{center}
\end{table}
\subsection{Simplified discrete problem}
\label{sec:discrete problem}
From the~\autoref{tbl:times}, it can be seen that all the times are multiples
of 1.5 seconds. So we can ignore the actual speeds and dimensions. We can just
use multiplies of 1.5 seconds, which we will call timesteps. One timestep is
equal to 1.5 seconds. All the movements take a discrete number of timesteps.
And every movements ends up in the exact center of the parking place.

For the car park, we use graph $\mathcal{G} = (\V,\E)$, where every vertex is a
parking space and every edge $(u,v)$ means that there is no obstacle between
parking spaces~$u$ and~$v$. The parking places can be at most 4-way-connected,
with the connections corresponding to directions in $\D$.

Every parking space has status. We let $K$ be the number of different labels we
want to give to cars. All possible node statuses are described
in~\autoref{tbl:statuses}. We denote the set of all node statuses as~$\W$.

\begin{table}
    \begin{center}
        \begin{tabular}{| c | c |}
            \hline
            Status & Meaning \\
            \hline
            \stat{e} & Parking space is empty.\\
            \stat{r} & There is robot on the parking space.\\
            \stat{i} & There is a car with label $i$ in
            the parking space.\\
            \stat{ri} & There is a car with label $i$ and a robot is under it.\\
            \stat{ir} & There is a robot carrying the car with label $i$.\\
            \stat{lft} & There is a robot in the process of lifting a car.\\
            \stat{drp} & There is a robot in the process of dropping a car.\\
            \hline
        \end{tabular}
        \TODO{make this table nice}
        \caption{We all different possible statuses of parking spaces with
            their descriptions. Note that $\stat{i} \in \{0,\ldots,K-1\}$. So
            when there is a robot carrying car with label 2, the status should
            be \stat{2r}, not \stat{ir}.}
        \label{tbl:statuses}
    \end{center}
\end{table}

When a object moves from node~$u$ to an adjacent node $v$, the initial node
status remains the same for the whole duration of the movement. Meaning that
even though the moving object partly blocks both~$u$ and~$v$, the node statuses
for~$u$ and ~$v$ will still be the old ones, until the moving object reaches the center
of~$v$, at which point node statuses are updated. As an example of this
see~\autoref{fig:movingstatus}.

\begin{figure}[h]
    \begin{center}
        \input{fig/movingstatus}
        \caption{This diagram serves as an illustration for node statuses
            during movement. Each row represents a seperate timestep of the
            same nodes. Gray boxes represent parking spaces and the green
            circle represents a moving robot. Below each parking space is the node
        status.}
        \label{fig:movingstatus}
    \end{center}
\end{figure}

The problem is to find a suitable sequence of actions for robots, to
reconfigure the given initial configuration into the terminal configuration.
Both initial and terminal configurations are given by node statuses for every
vertex.

Sometimes a given initial status with given terminal status is unsolvable no
matter how many timesteps are considered. For a very simple example
see~\autoref{fig:unsolvable}.

\begin{figure}[h]
    \begin{center}
        \input{fig/invalidconf}
        \caption{This figure shows a pair of initial and terminal statuses,
            which cannot be solved. Green robot can move under the cars, but there
            is no way how red car can exchange places with the blue car without
        colliding.}
        \label{fig:unsolvable}
    \end{center}
\end{figure}
